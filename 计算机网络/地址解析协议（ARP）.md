# 地址解析协议（ARP）
地址解析协议（ARP）是指网络地址和MAC地址之间的转换
当一台主机需要向另一台主机发送数据时，需要知道目的主机的ip地址外还需要知道目的主机的mac地址。源主机首先会在自己的ARP表中寻找目的ip对应的mac地址，无法找到则发出一个arp广播包，目的主机收到广播包后发送一个响应报文告知源主机自己的mac地址。
## 交换机对包的处理：
当交换机收到包时，会查找交换机表，其可能遇到三种情况：
1. 未找到相应记录，广播该包，将该包发送给除源端口外的所有端口
2. 找到相应记录，且对应端口与源端口不同，将该包转发给相应端口
3. 找到相应端口，但相应端口与源端口相同，将该包丢弃
## 路由器对ARP的处理
路由器会阻断包括ARP在内的广播包，也就是说主机无法通过以上的方式获取目的主机的mac地址。  
当两台主机位于不同子网或网段时，主机之间无法通过交换机通信，这个时候必须借助网关或者路由器。当主机发现访问的主机位于不同网段时，主机会将包发送给路由器，在通过路由器转发该包。
![20190725162055.png](https://raw.githubusercontent.com/zdzh/pothos/master/img/20190725162055.png)  
上图中，H1主机发送数据包给H2，在传输过程中，目的ip始终为h2的ip，但目的mac地址是下一跳的mac地址。
需要注意的是，图中没有注明每个路由器的ip地址，而在实际网络中，路由器内含有一个交换表注明目的ip与下一跳ip的映射，路由器底层将下一跳的ip进行转化以获取下一跳的mac地址。